<app-common-header></app-common-header>
<mat-spinner class="spinner" *ngIf="loader"></mat-spinner>
<div class="disable-background" *ngIf="loader"></div>


<div class="module_body">
    <nav class="headerbar">
        <!-- <div class="headerbar-container">
            <div class="header">
                <h3>Project Execution Summary <span *ngIf="dataTill">Last updated {{dataTill}}</span></h3>
            </div>
        </div> -->
    </nav>

    <div class="view-container">
        <!-- <div class="filters"> -->
        <div class="filters-wrapper">
            <!-- <div class="filters-meta">
                    <p>Showing results for <strong>Customer Churn, End date of 01 Jan or before, Drift greater than 10%, Data Quality greater than 60% and Error of more than 30%</strong></p>
                </div> -->
            <!-- <div class="filters-meta">
                    <h4 joyrideStep="step16" title="{{tours.step16.title}}" text="{{tours.step16.text}}">Filters</h4>
                </div>
                <ul class="filters-list" [formGroup]="filtersForm">
                    <li class="link" (click)="clearFiltersForm($event)">Clear All</li>
                    <li class="input-group">
                        <label>Model Name</label>
                        <mat-form-field class="select" [floatLabel]="'never'">
                            <mat-select formControlName="projectType" (selectionChange)="adminFilter($event)">
                                <mat-option *ngFor="let option of projectTypes" [value]="option.value">
                                    {{option.show}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </li>
                    <li class="input-group">
                            <label>Project Name</label> -->
            <!-- <div class="flex">
                                <input matInput type="text" class="projSearch" placeholder="Select project" value="" (keyup)='keyUp.next($event.target.value)' formControlName="projectName" (blur)="projectNameSearchBlur($event)" />
                                <mat-icon matSuffix class="search-icon"
                                        (mouseenter)="onHoverSearchIcon()" 
                                        (mouseleave)="onLeaveSearchIcon()"
                                        (click)="clearSearch()"
                                    >{{iconText}}</mat-icon>
                            </div> -->
            <!-- </li> -->
            <!-- <li class="input-group">
                        <label>Start Date</label>
                        <mat-form-field class="date" floatLabel="never">
                            <input matInput [matDatepicker]="startPicker" placeholder="Select start date" (dateChange)="startDateChange('change', $event)" formControlName="startDate">
                            <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                            <mat-datepicker #startPicker></mat-datepicker>
                        </mat-form-field>
                    </li>
                    <li class="input-group">
                        <label>End Date</label>
                        <mat-form-field class="date" floatLabel="never">
                            <input matInput [matDatepicker]="endPicker" placeholder="Select end date" (dateChange)="endDateChange('change', $event)" formControlName="endDate">
                            <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                            <mat-datepicker #endPicker></mat-datepicker>
                        </mat-form-field>
                    </li>
                    <li class="input-group">
                        <label>Drifted By</label>
                        <mat-form-field class="select" [floatLabel]="'never'">
                            <mat-select formControlName="driftBy" (selectionChange)="driftMorethan($event)">
                                <mat-option *ngFor="let option of driftBy" [value]="option.value">
                                    {{option.show}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </li> -->

            <!-- <li class="input-group">
                        <label>Data Quality</label>
                        <mat-form-field class="select" [floatLabel]="'never'">
                            <mat-select [(ngModel)]="dropdownLabel">
                                <mat-option *ngFor="let option of options" [value]="option">
                                    {{option}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </li> -->
            <!-- disabled temporarily -->
            <!-- <li class="input-group">
                        <label>Error</label>
                        <mat-form-field class="select" [floatLabel]="'never'">
                            <mat-select formControlName="errorBy">
                                <mat-option *ngFor="let option of errorBy" [value]="option.value">
                                    {{option.show}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </li> -->
            <!-- </ul> -->
        </div>
        <!-- </div> -->

        <div class="views" style="margin-top: 23px;">
            <div class="page-meta">
                <div class="page-meta-container">
                    <!-- <div class="tile">
                        <div joyrideStep="step17" title="{{tours.step17.title}}" text="{{tours.step17.text}}" class="tile-label">Pipelines with more than 30% Drift</div>
                        <div class="tile-value">{{driftGT30}}</div>
                    </div>
                    <div class="tile">
                        <div class="tile-label">No. of Drift Jobs</div>
                        <div class="tile-value">{{driftCount}}</div>
                    </div>
                    <div class="tile">
                        <div class="tile-label">No. of Explainability Jobs</div>
                        <div class="tile-value">{{xaiCount}}</div>
                    </div>
                    <div class="refresh">
                        <button class="refreshButton" (click)="refreshOverviewTable($event)" [disabled]="isRefreshing">
                      <mat-icon class="material-icons refreshIcon" matTooltip="Refresh" matTooltipPosition="above">
                        refresh
                      </mat-icon>
                    </button> -->
                    <!-- <mat-icon joyrideStep="step18" title="{{tours.step18.title}}" text="{{tours.step18.text}}" class="material-icons add-icon" matTooltip="Add new project" matTooltipPosition="above" (click)="goToSetup($event)">
                            add_circle_outline
                        </mat-icon> -->
                    <!-- <button class="primary" style="height: 37px; align-self: center; width: 110px;" [disabled]="isRefreshing" (click)="refreshOverviewTable()">
                        <img *ngIf="isRefreshing" style="width: 10px;" src="assets/img/refresh.gif" />
                        Refresh
                    </button> -->
                    <!-- </div> -->
                </div>
            </div>
            <div class="widget opaque rounded">

                <table mat-table [dataSource]="dataSource" class="data_table" matSort>
                    <ng-container matColumnDef="{{column.field}}"
                        *ngFor="let column of columnsToDisplay; let i = index;">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                            <p *ngIf="column.header === 'By'" joyrideStep="step19" title="{{tours.step19.title}}"
                                text="{{tours.step19.text}}" class="sort">{{column.header}}</p>
                            <p *ngIf="column.header === 'Output'" joyrideStep="step20" title="{{tours.step20.title}}"
                                text="{{tours.step20.text}}" class="sort">{{column.header}}</p>
                            <p *ngIf="column.header === 'Graph'" joyrideStep="step21" title="{{tours.step21.title}}"
                                text="{{tours.step21.text}}" (next)="onStep21Next()" class="sort">{{column.header}}</p>
                            <p *ngIf="column.header !== 'Graph' && column.header !== 'Output' && column.header !== 'By'"
                                class="sort">{{column.header}}</p>
                        </th>
                        <td mat-cell *matCellDef="let element" [ngClass]="{'centerAlign': column.header === 'Status' }">
                            <p (click)="goToDetails($event, column.header, element.projectId, element.name, element.executionType, element.latestExec, element.createdBy)"
                                style="min-height: 2.7vh;"
                                [ngClass]="{'status': column.header === 'Status' || column.header === 'Drift', 'green': (column.header === 'Status' && element.status === 'Success') || (column.header === 'Drift' && element.green === true), 'orange': (column.header === 'Status' && element.status === 'Running') || (column.header === 'Drift' && element.yellow === true), 'red': (column.header === 'Status' && element.status === 'Failed') || (column.header === 'Drift' && element.red === true), 'detail': column.header === 'Output', 'graph': column.header === 'Graph', 'icon': column.header === 'Output' || column.header === 'Graph', 'cursor': (column.header === 'Project Name') || column.header === 'Project Name' || (column.header === 'Graph' && element.createdBy === 'admin')}"
                                [matTooltip]="column.header === 'Status' ? element.status : column.header === 'Output' ? 'Dashboard' : column.header === 'Graph' ? 'Code visual' : ''"
                                matTooltipPosition="above">{{element[column.field]}}</p>
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="columnsProps"></tr>
                    <tr mat-row class="data_table" *matRowDef="let row; columns: columnsProps;"></tr>
                </table>
                <mat-paginator [pageSizeOptions]="[15]" showFirstLastButtons></mat-paginator>
            </div>
        </div>
    </div>

</div>

<app-common-footer></app-common-footer>